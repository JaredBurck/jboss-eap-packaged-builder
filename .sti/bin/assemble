#!/bin/sh

# Resulting WAR files will be deployed to /opt/eap/standalone/deployments
# Source code provided to S2I is at ${HOME}/source                              
DEPLOY_SOURCE_DIR=${HOME}/source/deployment
mkdir -p $DEPLOY_SOURCE_DIR 

# Copy (probably binary) artifacts from the deployments/
# directory to the $JBOSS_HOME/standalone/deployments/
# directory for later deployment

if [ ! -z "${SRC_APP_URL}" ]; then
 
 SRC_APP_NAME=${SRC_APP_NAME:-"ROOT.ear"}
 
 echo "Downloading packaged application source from ${SRC_APP_URL}..."
 
 curl -L -fs -o "${DEPLOY_SOURCE_DIR}/${SRC_APP_NAME}" "${SRC_APP_URL}"
 
 ERR_APP_RETRIEVAL=$?
 if [ $ERR_APP_RETRIEVAL -ne 0 ]; then
   echo "Error retrieving packaged application due to error code $ERR_APP_RETRIEVAL"
   exit $ERR_APP_RETRIEVAL
 fi
 
fi

/usr/local/s2i/assemble
#exit 0
